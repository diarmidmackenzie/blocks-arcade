
<!-- TetrisLand.  A VR world with many different Tetris Game Modes
     ... and perhaps some other things too...? -->

<html>
  <head>
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@2.0.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.min.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/diarmidmackenzie/key-bindings@latest/key-bindings.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/diarmidmackenzie/6dof-object-control@v0.1-alpha/src/6dof-object-control.min.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/gh/diarmidmackenzie/6dof-object-control@latest/src/keyboard-hand-controls.min.js"></script>-->
    <script src="../../6dof-object-control/src/keyboard-hand-controls.js"</script>
    <script src="keyboard-hand-controls.js"</script>
    <!-- couple of possible locations for tetris.js, depending on environment-->
    <script src="../../tetris-engine/src/tetris.js"></script>
    <script src="tetris.js"></script>
    <script src="tetrisland-utils.js"></script>
  </head>
  <body>
    <a-scene renderer="colorManagement:true">
      <a-entity id="rig" movement-controls
                key-bindings="bindings:KeyP=jump"
                scene-jumps="positions:0 0 0 0 0 0,
                             1.25 0 -3 -15 -90 0,
                             -1.1 0 -3 -15 90 0,
                             1.25 0 -6 -15 -90 0,
                             -1.1 0 -6 -15 90 0">
        <a-entity id="camera" camera position="0 1.6 0" look-controls proximity>
        </a-entity>
        <a-entity id="lhand"
                  hand-controls="hand: left"
                  teleport-controls="cameraRig: #rig; teleportOrigin: #camera; button: trigger">
        </a-entity>
        <a-entity id="rhand"
                  hand-controls="hand: right"
                  teleport-controls="cameraRig: #rig; teleportOrigin: #camera;">
        </a-entity>
        <!-- Alternative, for debugging on PC...
        <a-entity id="rhand"
                  hand-controls="hand: right"
                  keyboard-hand-controls="logger:#log-panel3"
                  position = "-3 1 -3">
        </a-entity>
        <a-text id="log-panel3" value="Keyboard Sim Data" position="-2 2 -4" color="black"></a-text>-->


      </a-entity>

      <a-mixin id="cube" geometry="primitive: box;"
               scale="0.1 0.1 0.1"
               shadow></a-mixin>
      <a-mixin id="metal" material="color:0xFFF;metalness:0.8"></a-mixin>
      <a-mixin id="glass" material="transparent:true;opacity:0.3"></a-mixin>

      <a-mixin id="start"
               src="start.png"
               scale="0.1 0.1 0.1"
               class="clickable"
               proximity="target:#rhand;start:start"
               event-set__start="_event: start; visible: false"
               event-set__gameover="_event: game-over; visible: true">
      </a-mixin>

      <a-entity environment="preset: forest; dressingAmount: 500"></a-entity>

<!--WELCOME BANNER------------------------------------------------------------->
<a-plane id="welcome"
         transparent
         opacity="0.8"
         height="2.3" width="1.8"
         rotation="0 0 0"
         position = "0 1.5 -1.5"
         text="color:black;value:TETRISLAND is a VR-first Immersive Web Games Arcade, inspired by the classic falling blocks game.

         If you are playing in VR, just walk through the screen and choose a game to play.
         You can also move using the Right thumbstick or teleport using the Left Trigger.

         If you are playing on a computer with keyboard, press P to jump right in front of each game in turn.
         Or you can walk around using WASD, or arrow keys.  Sorry, but we don't support phones & tablets.

         Your controls will automatically attach to the game that you are nearby.  You will see the base turn red.

         Tetrisland is at a very early stage of development, so please be understanding if things don't work quite as you expected.

         Any comments or feedback are very much appreciated.  We are on Twitter at @tetrisland.

         Tetrisland is 100% Open Source, and open to community contributions.  You can find us on GitHub.">
       </a-plane>

<!--1: 2D TETRIS, 1st unit on the right ------------------------------------------>
      <!-- Note shapes have to be oriented N-S, not E-W due to the game orientation-->
      <!-- Likewise x & z axes controls swapped over from samples-->
      <!-- Proximity rule means that the game will be controllable when the
           player is within 2m of the dropper-->
      <a-entity id='shape-gen1' shapegenerator="arena:#arena1;
                                                shapes:NNN,NNU,NND,NUN,NDN,NUDN,NUS;
                                                keys:KeyZ=zminus,
                                                     KeyX=zplus,
                                                     Enter=xRotMinus,
                                                     ShiftRight=xRotPlus,
                                                     Space=drop"
                                              position = "3 2 -3"></a-entity>
      <!-- game start control is a sphere, 10cm radius-->
      <a-sphere id="game1" tetrisgame="generator: #shape-gen1; scoreboard: #scoreboard1; arena: #arena1;focus:false"
                position="3 1 -2"
                mixin="glass start"
                src="start.png"
                rotation="0 -120 0"
                key-bindings="bindings:Enter=start,#stand1.focus=focus,#stand1.defocus=defocus"
                event-set__show="_target:#help1;_event:game-over; visible:true"
                event-set__hide="_target:#help1;_event:start; visible:false">
      </a-sphere>

      <!-- Put the game on a metal stand-->
      <!-- Proximity to this is used to determine focus on the game -->
      <!-- Using proximity of right hand, as we can't get
          camera position - see https://stackoverflow.com/questions/57451862/in-a-frame-how-do-i-get-the-vr-camera -->
      <a-box id="stand1"
             proximity="target:#camera;axes:XZ;start:focus;end:defocus;distance:2.5"
             shadow="receive:true" mixin="metal"
             height="0.5" width="0.5" depth="1.0"
             position = "3 0.25 -3.05"
             event-set__focus="_event: focus; material.color:red"
             event-set__defocus="_event: defocus; material.color:white"></a-box>
      <a-plane visible=false
               id="arena1"
               shadow="receive:true"
               height="1.0" width="0.1"
               rotation="-90 0 0"
               arena="x: 1; z: 10"
               position = "3 0.5 -3.05" ></a-plane>
      <a-box mixin="glass" height="1.5" width="0.5" depth="1.0" position = "3 1.25 -3.05" ></a-box>

      <!--Scoreboard, and some text to guide the user-->
      <a-text id="scoreboard1" value="Score" rotation="0 -90 0" position="3 1.8 -2.3" color="black"></a-text>
      <a-text value="Classic\n2D Tetris" rotation="0 -90 0" position="2.75 0.25 -3.5" color="black"></a-text>
      <a-text id="help1" dualtext="desktoptext:Enter to start\n\nMove L/R:\n Z & X\n\nRotate:\nR-Shift/Enter\n\nSpace to drop;
                                   vrtext:Touch the\nsphere to start\nMove:\nGrip & move\nRotate:\nTrigger & turn\nA to drop"
                     rotation="0 -90 0" width="3" position="2.75 1.3 -3.5" color="black" visible="true">
      </a-text>

<!--2: 3D TETRIS, 1st unit on the left ---------------------------------------->
      <!-- Note shapes have to be oriented N-S, not E-W due to the game orientation-->
      <a-entity id='shape-gen2' shapegenerator="arena:#arena2" position = "-3 2 -3"></a-entity>
      <!-- game start control is a sphere, 10cm radius, to the right of the game-->
      <a-sphere id="game2" tetrisgame="generator: #shape-gen2; scoreboard: #scoreboard2; arena: #arena2"
                position="-3 1 -3.75"
                mixin="glass start"
                src="start.png"
                rotation="0 60 0"
                key-bindings="bindings:Enter=start,#stand2.focus=focus,#stand2.defocus=defocus"
                event-set__show="_target:#help2;_event:game-over; visible:true"
                event-set__hide="_target:#help2;_event:start; visible:false">
              </a-sphere>

      <!-- Put the game on a metal stand-->
      <a-box id="stand2"
             proximity="target:#camera;axes:XZ;start:focus;end:defocus;distance:2.5"
             shadow="receive:true" mixin="metal"
             height="0.5" width="0.7" depth="0.7"
             position = "-3 0.25 -3"
             event-set__focus="_event: focus; material.color:red"
             event-set__defocus="_event: defocus; material.color:white">
             </a-box>
      <a-plane visible=false id="arena2" shadow="receive:true" height="0.5" width="0.5" rotation="-90 0 0"  arena="x: 5; z: 5" position = "-3 0.5 -3" ></a-plane>
      <a-box mixin="glass" height="1.5" width="0.5" depth="0.5" position = "-3 1.25 -3" ></a-box>

      <!--Scoreboard, and some text to guide the user-->
      <a-text id="scoreboard2" value="Score" rotation="0 90 0" position="-3 1.8 -3.3" color="black"></a-text>
      <a-text value="3D\nTetris" rotation="0 90 0" position="-2.65 0.25 -2.65" color="black"></a-text>
      <a-text id="help2" width="3" dualtext="desktoptext:Enter to\n Start\nMove:\nYGHJ\nRotate:\n4/6, 7/9\n& 8/5\n\nDrop:\nSpace;
                                   vrtext:Touch the\nsphere to start\nMove:\nGrip & move\nRotate:\nTrigger & turn\nA to drop"
                     rotation="0 90 0" width="3" position="-2.75 1.3 -2.75" color="black" visible="true">
      </a-text>

      <!--Overhead lighting is important for 3D Tetris -->
      <a-entity light="type:directional; castShadow:true;" position='3 20 -3'></a-entity>

<!--3: 2D PENTRIS, 2nd unit on the right -------------------------------------->
      <!-- Note shapes have to be oriented N-S, not E-W due to the game orientation-->
      <!-- Likewise x & z axes controls swapped over from samples-->
      <a-entity id='shape-gen3' shapegenerator="arena:#arena3;
                                                keys:KeyZ=zminus,
                                                     KeyX=zplus,
                                                     Enter=xRotMinus,
                                                     ShiftRight=xRotPlus,
                                                     Space=drop;
                                              shapes:NNNN,NNNU,NNND,NNUN,NNDN,NNDD,NNDS,NNUS,NNSDD,NDND,NDNSD,SDSND,NUDDUN"
                                              position = "3 2 -6"></a-entity>
      <!-- game start control is a sphere, 10cm radius-->
      <a-sphere id="game3" tetrisgame="generator: #shape-gen3; scoreboard: #scoreboard3; arena: #arena3"
                position="3 1 -5"
                mixin="glass start"
                src="start.png"
                rotation="0 -120 0"
                key-bindings="bindings:Enter=start,#stand3.focus=focus,#stand3.defocus=defocus"
                event-set__show="_target:#help3;_event:game-over; visible:true"
                event-set__hide="_target:#help3;_event:start; visible:false">
                </a-sphere>

      <!-- Put the game on a metal stand-->
      <a-box id="stand3"
             proximity="target:#camera;axes:XZ;start:focus;end:defocus;distance:2.5"
             shadow="receive:true" mixin="metal"
             height="0.5" width="0.5" depth="1.2"
             position = "3 0.25 -6.05"
             event-set__focus="_event: focus; material.color:red"
             event-set__defocus="_event: defocus; material.color:white">
      </a-box>
      <a-plane visible=false id="arena3" shadow="receive:true" height="1.2" width="0.1" rotation="-90 0 0"  arena="x: 1; z: 12" position = "3 0.5 -6.05" ></a-plane>
      <a-box mixin="glass" height="1.5" width="0.5" depth="1.2" position = "3 1.25 -6.05" ></a-box>

      <!--Scoreboard, and some text to guide the user-->
      <a-text id="scoreboard3" value="Score" rotation="0 -90 0" position="3 1.8 -5.3" color="black"></a-text>
      <a-text value="2D Pentris" rotation="0 -90 0" position="2.75 0.25 -6.5" color="black"></a-text>
      <a-text id="help3" dualtext="desktoptext:Enter to start\n\nMove L/R:\n Z & X\n\nRotate:\nR-Shift/Enter\n\nSpace to drop;
                                   vrtext:Touch the\nsphere to start\nMove:\nGrip & move\nRotate:\nTrigger & turn\nA to drop"
                     rotation="0 -90 0" width="3" position="2.75 1.3 -6.5" color="black" visible="true">
      </a-text>

<!--3D PENTRIS, 2nd unit on the left ------------------------------------------>
      <!-- For now, we just use the 2D pentris tiles, re-oriented to the X/Z plane-->
      <!-- TBC whether this makes for a fun game... -->

      <a-entity id='shape-gen4'
                shapegenerator="arena:#arena4;
                shapes:shapes:NNNN,NNNE,NNNW,NNEN,NNWN,NNWW,NNWS,NNES,NNSWW,NWNW,NWNSW,SWSNW,NEWWEN"
                position = "-3 2 -6">
      </a-entity>
      <!-- game start control is a sphere, 10cm radius, to the right of the game-->
      <a-sphere id="game4" tetrisgame="generator: #shape-gen4; scoreboard: #scoreboard4; arena: #arena4"
                position="-3 1 -6.75"
                mixin="glass start"
                src="start.png"
                rotation="0 60 0"
                key-bindings="bindings:Enter=start,#stand4.focus=focus,#stand4.defocus=defocus"
                event-set__show="_target:#help4;_event:game-over; visible:true"
                event-set__hide="_target:#help4;_event:start; visible:false">
      </a-sphere>

      <!-- Put the game on a metal stand-->
      <a-box id="stand4"
             proximity="target:#camera;axes:XZ;start:focus;end:defocus;distance:2.5"
             shadow="receive:true" mixin="metal"
             height="0.5" width="0.7" depth="0.7"
             position = "-3.05 0.25 -6.05"
             event-set__focus="_target:#stand4;_event: focus; material.color:red"
             event-set__defocus="_target:#stand4;_event: defocus; material.color:white">
      </a-box>
      <a-plane visible=false id="arena4" shadow="receive:true" height="0.6" width="0.6" rotation="-90 0 0" arena="x: 6; z: 6" position = "-3.05 0.5 -6.05" ></a-plane>
      <a-box mixin="glass" height="1.5" width="0.6" depth="0.6" position = "-3.05 1.25 -6.05" ></a-box>

      <!--Scoreboard, and some text to guide the user-->
      <a-text id="scoreboard4" value="Score" rotation="0 90 0" position="-3.05 1.8 -6.45" color="black"></a-text>
      <a-text value="3D\nPentris" rotation="0 90 0" position="-2.7 0.25 -5.7" color="black"></a-text>
      <a-text id="help4" width="3" dualtext="desktoptext:Enter to\n Start\nMove:\nYGHJ\nRotate:\n4/6, 7/9\n& 8/5\n\nDrop:\nSpace;
                                   vrtext:Touch the\nsphere to start\nMove:\nGrip & move\nRotate:\nTrigger & turn\nA to drop"
                     rotation="0 90 0" width="3" position="-2.75 1.3 -5.75" color="black" visible="true">
      </a-text>

      <!--Overhead lighting is important for 3D Tetris games
          This one will probably wreck the nearby 3D Tetris, though...
          So leave it off.  Ideally we need to be able to turn lights on/off when
          game starts-->

      <!--<a-entity light="type:directional; castShadow:true;" position='3 20 -6'></a-entity>-->

    </a-scene>
  </body>
</html>
